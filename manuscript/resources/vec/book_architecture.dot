digraph{ concentrate=true

#
# labelled nodes
#

 V12             [label="DC\nproduction"]
 V12_consumption [label="DC\nconsumption"]
#V48 [label="48 V"]
V230 [label="AC"]
keep_watch [label="keep watch\nat all times"]

{node [label=charge] 
 chargebatt12 
#chargebatt48 
}
{node [label="power\nsupply"]
 batt12supply 
#batt48supply 
}
{node [label="boil water"] 
boil_water_12 boil_water_solar }

#
# typed nodes
#

{ node[shape=none fillcolor="lightgreen" class=type_permaculture_principle ]
pp01 [ label="1 observe"     tooltip="Observe and Interact" ]
pp02 [ label="2 catch/store" tooltip="Catch and Store Resources" ]
pp03 [ label="3 obtain"      tooltip="Obtain a Yield" ]
pp04 [ label="4 self-r"      tooltip="Apply Self-Regulation" ]
pp05 [ label="5 renewable"   tooltip="Use Renewable Resources" ]
pp06 [ label="6 no waste"    tooltip="Produce No Waste" ]
pp07 [ label="7 patterns"    tooltip="Design from Patterns to Details" ]
pp08 [ label="8 integrate"   tooltip="Integrate Rather than Segregate" ]
pp09 [ label="9 small/slow"  tooltip="Use Small and Slow Solutions" ]
pp10 [ label="10 diversity"  tooltip="Use and Value Diversity" ]
pp11 [ label="11 edges"      tooltip="Use Edges and Value the Marginal" ]
pp12 [ label="12 respond to change" tooltip="Creatively Use and Respond to Change" ]
}

{ node[shape=point label="" class=tyoe_anchor ] 
iv_catch iv_store_res iv_store_food iv_renewables iv_eat iv_longterm iv_midterm }


{ node[ style=filled penwidth=2 class=type_equipment ]
windpilot   [label="wind\npilot"  ]
windturbine [label="wind\nturbine"]
batt12      [label=battery]
panels12    [label="solar\npanels"]
solar_stove [label="solar\nstove"]
watermaker 
#wood_stove # better suited for eco-car book?
induction_stove [label="induction\nstove"]
inverter heaters #other_appliances
thermos immersionheater
water_tank
pot pan
siliconespoon
anchors anchor_windlass 
sails
engine
autohelm
instruments
#lights
}

#
# Clusters
#

subgraph cluster_renewables { iv_renewables
sun wind 
seawater
rainwater
seaweed
#wood # better suited for eco-car book?
}

subgraph cluster_catch{ labelloc=B label="Catch Resources"
panels12
#charge_controller_12 
#panels48 charge_controller_48 
windturbine
#charge_controller_turbine
sun -> solar_stove -> boil_water_solar
sails
windpilot
collect_rainwater
watermaker -> desalinate
seaweed -> collect_seaweed
#collect_firewood # better suited for eco-car book?
iv_catch
}

subgraph cluster_store{ label="Store (other) Resources"
{rank=same batt12 thermos water_tank }
freshwater [label="fresh water\nsupply"]
hot_water  [label=  "hot water\nsupply"]
immersionheater
 chargebatt12 batt12supply
#chargebatt48 batt48supply batt48 
water_tank -> freshwater
iv_store_res
boil_water_12
}

subgraph cluster_store_food { iv_store_food node [shape=cylinder]    label="Store Food"
subgraph cluster_midterm    { iv_midterm  labelloc=B fillcolor=white label="mid term"
onions eggs potatoes
}
subgraph cluster_longterm   { iv_longterm labelloc=B fillcolor=white label="long term"
sunflower_seeds
raisins
peanut_butter
mung_beans
rice
oatmeal
soy_sauce
mustard
olive_oil
rice
falafel_mix
mayonaise
}
} # END Store Food

subgraph cluster_eat{ iv_eat label="(Cook and) Eat"
tortilla_es      [label="Tortilla\nEspanol"]
rice_tika_masala [label="Rice Tika\nMasala"]
subgraph cluster_no_cooking{ fillcolor=white label="no cooking at all"
{raisins sunflower_seeds} -> quick_snack
{raisins peanut_butter} -> energy_snack
mung_beans -> Sprouts
{collect_seaweed olive_oil mustard} -> seaweed_salad
}
subgraph cluster_hot_water{ fillcolor=white label="just add hot water"
#
# just add hot water
hot_water -> {
ramen 
#instant_soup #taboule #pasta 
}
{hot_water raisins oatmeal sunflower_seeds} -> porridge
}
#
# quick pan
{pan eggs} -> omelette
{pan olive_oil hot_water falafel_mix} -> falafel
#
# intermediate steps
{pot hot_water rice} -> boiled_rice
{seawater solar_stove potatoes} -> boiled_potatoes
{pan olive_oil onions} -> fried_onions
#
# multi phase recipes
{boiled_rice eggs soy_sauce} -> Tamago
{mayonaise boiled_potatoes onions} -> potato_salad
{boiled_rice fried_onions } -> rice_tika_masala
{pan eggs potatoes fried_onions} -> tortilla_es
#
# other cook / eat
siliconespoon -> clean_dishes 
siliconespoon -> { prevent_food_waste preserve_water }
} # END cluster Eat
{ prevent_food_waste preserve_water } -> autonomy

subgraph cluster_drink{ label="Drink"
hot_water -> {tea coffee}
freshwater -> water
}

subgraph cluster_electro{ labelloc=B label="electro backbone" 
V12 V12_consumption inverter V230 induction_stove
engine
}

subgraph cluster_seamanship {

subgraph cluster_anchoring { fillcolor=white
shore -> anchoring
anchor_windlass -> anchors -> anchoring
lift_anchor -> anchors
}

subgraph cluster_sailing { fillcolor=white
navigate
propulsion
sailing
steering
control_sails
handsteer
instruments
autohelm
}

instruments -> navigate-> sailing
crew -> navigate
crew -> handsteer -> steering
crew -> lift_anchor 
crew -> keep_watch -> { sailing anchoring }
crew -> control_sails -> sailing

} END Seamanship

subgraph cluster_infrastructure{ labelloc=B label=Infrastructure
public_sources
grocery_stores
farmers
}

#
# EDGES
#

public_sources -> top_up -> water_tank
 grocery_stores -> months_or_years -> iv_longterm
{grocery_stores farmers} -> weeks  -> iv_midterm

anchoring -> autonomy
# anchoring -> rest -> crew

rainwater -> collect_rainwater -> water_tank
seawater  -> desalinate        -> water_tank


V12_consumption -> immersionheater -> boil_water_12 -> thermos -> hot_water
boil_water_solar -> thermos

# correct but high lod:
#freshwater -> { boil_water_12 boil_water_solar }

hot_water -> {clean_dishes wash_hair}

 sun -> panels12 -> 
#charge_controller_12 -> 
V12
#sun -> panels48 -> charge_controller_48 -> V48

V12 -> V12_consumption [minlen=3] # space vertically to make room for storage in between

V12-> chargebatt12 -> batt12 -> batt12supply -> V12_consumption

#batt48supply -> V48-> chargebatt48
#batt48 -> { chargebatt48 batt48supply }

V12_consumption -> {
#lights 
anchor_windlass instruments}

V12_consumption ->
#stepup -> V48
#V48 ->
engine -> propulsion

#V48 # too much LOD
V12_consumption
-> inverter -> V230 -> {induction_stove heaters #other_appliances
}

induction_stove -> {pan pot}

#wood -> collect_firewood -> wood_stove -> pan # better suited for eco-car book?

wind -> windpilot -> steering   -> sailing
wind -> sails     -> propulsion -> sailing -> autonomy
wind -> windturbine ->
#charge_controller_turbine -> # too much LOD
V12

V12_consumption -> autohelm -> steering

#
# Permnaculture Validation
#

pp01 -> tides_waves -> { anchoring navigate }
pp01 -> windspeed_direction -> {control_sails navigate }
pp01 -> keep_watch
pp01 -> V12
pp02 -> {iv_store_res iv_store_food } -> autonomy
pp02 -> iv_catch
pp03 -> batt12supply 
#pp03 -> iv_store_res
pp04 -> {windpilot panels12 windturbine}
pp05 -> iv_renewables
pp06 -> siliconespoon 
pp06 -> immersionheater
pp08 -> { shore panels12 }
pp09 -> { sailing engine solar_stove immersionheater }
pp10 -> iv_eat
pp11 -> { shore panels12 }
pp12 -> { anchoring }

}
